{
    "monitors": [
        {
            "name": "[SentinelAI] Critical Tool Usage (Delete Database)",
            "type": "llm-observability alert",
            "query": "llm-observability(\"@event_type:span @ml_app:sentinel-ai @resource:delete_database\").rollup(\"count\").last(\"5m\") > 0",
            "message": "CRITICAL: The 'delete_database' tool was accessed by the Agent. Review trace {{trace.id}} immediately. @pagerduty",
            "tags": [
                "service:sentinel-ai",
                "type:security",
                "team:sentinel-security"
            ],
            "options": {
                "thresholds": {
                    "critical": 0
                }
            }
        },
        {
            "name": "[SentinelAI] Agent Refusal (Safety Filter)",
            "type": "llm-observability alert",
            "query": "llm-observability(\"@event_type:span @ml_app:sentinel-ai @sentinel.refusal:true\").rollup(\"count\").last(\"5m\") > 0",
            "message": "The Agent refused a user request (Safety Tag Detected). \n\nReview the trace in LLM Observability.",
            "tags": [
                "service:sentinel-ai",
                "type:safety",
                "team:sentinel-security"
            ],
            "options": {
                "thresholds": {
                    "critical": 0
                }
            }
        }
    ],
    "dashboards": [
        {
            "title": "SentinelAI: Agent Overseer",
            "description": "Real-time visibility into Agent reasoning, performance, and security risks.",
            "layout_type": "ordered",
            "widgets": [
                {
                    "definition": {
                        "title": "LLM Requests (Real-time)",
                        "type": "timeseries",
                        "requests": [
                            {
                                "q": "sum:trace.fastapi.request.hits{service:sentinel-ai}.as_count()"
                            }
                        ]
                    }
                },
                {
                    "definition": {
                        "title": "Security Spikes (Dangerous Tools)",
                        "type": "query_value",
                        "requests": [
                            {
                                "q": "trace.fastapi.request{service:sentinel-ai,resource:delete_database}.as_count()"
                            }
                        ]
                    }
                },
                {
                    "definition": {
                        "title": "Agent Refusals (Refused by Safety Tag)",
                        "type": "query_value",
                        "requests": [
                            {
                                "formulas": [
                                    {
                                        "formula": "query1"
                                    }
                                ],
                                "queries": [
                                    {
                                        "data_source": "spans",
                                        "name": "query1",
                                        "search": {
                                            "query": "service:sentinel-ai @sentinel.refusal:true"
                                        },
                                        "compute": {
                                            "aggregation": "count"
                                        }
                                    }
                                ]
                            }
                        ]
                    }
                },
                {
                    "definition": {
                        "title": "Knowledge Base Access (RAG Spans)",
                        "type": "query_value",
                        "requests": [
                            {
                                "formulas": [
                                    {
                                        "formula": "query1"
                                    }
                                ],
                                "queries": [
                                    {
                                        "data_source": "spans",
                                        "name": "query1",
                                        "search": {
                                            "query": "service:sentinel-ai resource:search_knowledge_base"
                                        },
                                        "compute": {
                                            "aggregation": "count"
                                        }
                                    }
                                ]
                            }
                        ]
                    }
                }
            ]
        }
    ]
}